# Quest Board

## Available

### Phase 1: Stabilize (stop losing work)
[elevator] Implement optimal merge strategy: rebase from fresh main, try clean merge, then -X ours, report only truly unresolvable conflicts
[elevator] Add fallback merge strategies: try ours, then theirs, then report specific conflict files
[elevator] Make elevator retry failed merges after other branches succeed (conflicts may resolve)

### Phase 2: Observe (can't improve what you can't measure)
[observe] Implement genome.json - externalize all evolvable state (prompts, models, context limits, protocols) into structured JSON
[observe] Load prompts from genome.json instead of hardcoded strings in squad.ts
[observe] Add timing logs per phase - track how long flute/logistics/quester/sheriff each take
[observe] Log to .undercity/metrics.jsonl - queryable history of quest durations, token usage, phase breakdowns
[observe] Track metrics per quest: success rate, time, tokens, retries, rejection rate, merge success
[observe] Track metrics per genome component - avgTime, avgTokens, successRate, rejectionRate
[observe] Surface metrics in status - "Quester: 8m (avg 3m)" so we know what's dragging
[observe] Create self-observation log - persistent record of quest outcomes in .undercity/observations.jsonl

### Phase 3: Baseline (know where we are before changing things)
[baseline] Capture baseline performance for each agent type before any evolution begins
[baseline] Record current prompt lengths, token usage patterns, success rates as generation 0
[baseline] Add "undercity baseline" command to snapshot current genome performance

### Phase 4: Evolve (improve iteratively based on evidence)
[evolve] Add mutation testing infrastructure - A/B test prompt variants, track sample size and results
[evolve] Allow agents to propose prompt/protocol mutations - test variants, keep what works
[evolve] Add "undercity reflect" command - analyze observation log, propose and test improvements automatically
[evolve] Remove human-readability constraint on internal comms - optimize for effectiveness and token efficiency
[evolve] Add convergence detection - recognize when a component has stopped improving (local optimum)
[evolve] Add genome rollback - reset to known-good state if evolution degrades performance
[evolve] Track cross-component effects - changing quester prompt may affect sheriff review success

### Phase 5: Portability (use on real projects)
[portability] Add support for external repos - undercity should work on any repo, not just itself
[portability] Detect target repo from cwd (nearest git root), create .undercity/ there if missing
[portability] Add "undercity init" command to initialize .undercity/ and intel.txt in a new repo

### Phase 6: Scale (handle more complexity)
[scale] Add task complexity classification - auto-classify quests as trivial/simple/standard/critical
[scale] Trivial tasks skip planning - single Haiku agent, no flute/logistics/sheriff overhead
[scale] Critical tasks get extra validators - scale Rule of Five with 5+ review passes
[scale] Smart model selection per task - Opus for complex planning, Sonnet for standard, Haiku for trivial
[scale] Add parallel quester support - spawn multiple questers working on different waypoints
[scale] Implement waypoint splitting in logistics - break large tasks into independent subtasks
[scale] Add a --parallel flag to control max concurrent agents (default 3, max 5)
[scale] Track which files each quester is touching to avoid conflicts between parallel agents

### High (important but not phase-gated)
[validation] Add worker/validator rejection loop - sheriff rejects → quester fixes → retry until approved or max retries
[validation] Track rejection iterations and feedback quality - what feedback leads to fastest fixes
[self-improvement] Add ability for agents to add new quests - parse "[NEW QUEST: ...]" markers
[self-improvement] Have sheriff generate follow-up quests for issues found during review
[self-improvement] Add failure retrospectives - when quest fails, analyze why and generate improvement quest
[self-improvement] Track user interventions - log manual steps, auto-generate improvement quests from patterns
[recovery] Add rollback mechanism - auto-tag pre-merge state, easy undo if merged quest breaks things
[control] Add quest dependencies - express "Quest A needs Quest B done first", block until satisfied
[control] Add cancel specific agent - kill stuck quester without surrendering entire raid
[speed] Add context summarization - don't pass entire plan file to every agent, summarize relevant parts
[speed] Add timeout handling - if agent takes >10 minutes, log warning and consider intervention
[ux] Add --json flag to status command - machine-readable output for Claude Code to parse
[ux] Add clear "needs attention" markers in status - things Claude Code should surface to user
[ux] Make `undercity work` background-friendly - good exit codes, status files Claude can poll
[tui] Build a TUI dashboard - combine status display and streaming logs in one view
[tui] Show raider status, current waypoint, progress bars, and live activity in a split-pane layout
[isolation] Add Docker isolation option - full sandbox mode for untrusted or risky code execution

### Medium
[budget] Add quota budgeting per quest - set max token spend, fail gracefully if exceeded
[validation] Sheriff runs the code - not just tests, actually execute to verify behavior works
[security] Add security scanning integration - run semgrep or similar, not just prompt-based OWASP checks
[review] Add "needs attention" queue - failures and blocked quests queue up for batch review when you're ready
[planning] Parse plan files into discrete goals/waypoints upfront instead of re-reading whole plan each iteration
[planning] Track which plan steps are complete in backlog so we don't re-check via codebase analysis
[planning] Add plan progress tracking - show "Step 3/7: Adding authentication" not just "executing"
[planning] Add "undercity import-plan <plan.md>" command to auto-extract quests from Claude plan files
[planning] Add context field to Quest interface - allow storing relevant plan snippets per quest
[planning] Implement context sharding - pass only relevant context to each raider type (flute gets less, quester gets more)
[visibility] Fix streamAgentActivity to properly show tool calls from SDK message format
[visibility] Show file paths when Read/Grep/Glob are called - "Reading src/raid.ts" not just "Read ..."
[visibility] Show Edit/Write targets - "Editing src/cli.ts:45" so you see what's being changed
[visibility] Add progress bar to plan command output (not just status command)
[visibility] Show estimated time remaining based on historical raid durations
[visibility] Add a --quiet flag for minimal output (just errors and completion)
[visibility] Add dual logging - write streaming output to both terminal AND .undercity/logs/current.log
[robustness] Add retry logic for failed agents - if quester fails, retry once before giving up
[robustness] Implement graceful degradation - if sheriff fails, still allow manual review option
[robustness] Add health checks - detect stuck agents (no activity for 5+ minutes)
[robustness] Save partial work on agent failure - don't lose progress if one agent crashes
[robustness] Handle rate limits gracefully - detect 429 errors, pause squad, show countdown to resume
[robustness] Add "undercity abort" command for emergency stop of runaway raids (kill all raiders, save state)
[robustness] Implement conversation compaction - summarize long raider contexts to avoid token limits
[loadout] Add loadout system - pre-raid configuration for different task types
[loadout] Add dogfood vs topside modes - different defaults for self-improvement vs external projects
[loadout] Add quest vetting gate - quests added mid-run go to pending_review, require approval before processing
[theme] Add "rat check" phase before extraction - dedicated review for hidden bugs that look harmless but will betray later
[theme] Add --light flag for "free loadout" mode - Haiku-only quick runs for small tasks, minimal context, minimal loss
[theme] Add pre-raid "extraction camper" check - detect potential merge conflicts before starting work, not at the end
[verbose] Add --verbose flag to show detailed raider activity during raids (tool calls, file reads, decisions)
[verbose] Add more streaming output for raiders - show what they're reading, writing, and deciding in real-time
[verbose] Create debug mode that logs full raider context/prompts for troubleshooting slow or stuck raiders
### Low
[webui] Optional web dashboard - browser-based status/logs view for when you're away from terminal
[audit] Add structured audit trail - queryable log of what agents did, not just text logs
[planning] Add logistics calibration - feedback loop to improve plan quality (too vague vs too detailed)
[advanced] Add branch strategy options - try two approaches in parallel, pick the winner
[qol] Add "undercity pause" command to pause a raid without surrendering
[qol] Add "undercity resume" command to continue a paused raid
[qol] Add "undercity logs <agent-id>" to see full output from a specific agent
[qol] Add config file support (.undercityrc) for default options like --stream, model choices
[qol] Add per-quest model selection - allow overriding raider models for specific quests
[future] Add cross-raid memory in stash - remember patterns/decisions from previous raids
[future] Add "rival raider" mode - spawn a review agent that tries to break the quester's code
[future] Implement Rule of Five verification - actually check that 5 review passes happened
[future] Add market intelligence agent - search online for competitor tools, emerging patterns in LLM orchestration
[future] Allow terminology/model evolution - if observations show a concept isn't useful, flag for deprecation
[future] Add swarm squad mode - all agents from start, sheriff monitors in real-time instead of at extraction

## Extracted
2026-01-09: Standardize agent terminology (flute/logistics/quester/sheriff)
2026-01-09: Rename MergeQueue to Elevator
2026-01-09: Add Philosophy section to README
2026-01-09: Fix quester model (Opus → Sonnet) in docs
2026-01-09: Add cspell dictionary
2026-01-09: Add experimentation framework - A/B testing for quest execution
2026-01-09: Add A/B efficiency tracking (linear vs swarm modes)
2026-01-09: Use git worktrees for raid branches
2026-01-09: Raiders work in worktree, elevator merges back to main
2026-01-09: Fix 48 TypeScript errors in metrics.ts and rate-limit.ts
2026-01-09: Add rate limit detection - pause squad, countdown timer, auto-resume (recovered from dangling commit)
2026-01-09: Sheriff must run pnpm typecheck before approving (recovered from dangling commit)
2026-01-10: Add comprehensive error recovery system - checkpoints, recovery orchestrator, escalation (recovered from dangling commit)
2026-01-10: Add enhanced rate limit detection - Retry-After headers, per-model limiting, proactive prevention (recovered from dangling commit)
2026-01-10: Add intel.txt parsing on raid start (recovered from dangling commit)
2026-01-10: Add oracle command for oblique strategies (recovered from dangling commit)
2026-01-10: Use 'raider' instead of 'agent' in user-facing output (recovered from dangling commit)
2026-01-10: CRITICAL FIX: Don't delete branch on merge failure - preserve worktrees/branches for manual recovery
2026-01-10: CRITICAL FIX: Don't mark quests complete when merge fails - only extract when work lands on main
2026-01-10: Worktree branches from origin/main after fetch - ensures fresh main even with external changes
2026-01-10: Elevator pushes to origin after successful merge - work is saved remotely, not just locally
2026-01-10: SDK agents now load .claude/rules/ via settingSources: ["project"] option
2026-01-xx: Add vitest tests for raid, cli, backlog modules (120 tests total)
2026-01-xx: Add --dry-run flag to slingshot
2026-01-xx: Add history command for completed raids
2026-01-xx: Add progress percentage to status command
2026-01-xx: Switch quester from Opus to Sonnet for speed
2026-01-xx: Cache flute results - if codebase hasn't changed, reuse previous flute intel

## Abandoned
