#!/bin/bash

# Run lint-staged for format/lint fixes on staged files
# This ensures what gets committed is what was checked
pnpm exec lint-staged

# Run full verification (typecheck, tests, etc.)
pnpm exec tsx src/verification-cli.ts

# Regenerate call-graph.json if source files changed
if git diff --cached --name-only | grep -q "^src/.*\.ts$"; then
    pnpm exec tsx scripts/generate-call-graph.ts > /dev/null 2>&1
    # Stage the updated call-graph if it changed
    if ! git diff --quiet .claude/call-graph.json 2>/dev/null; then
        git add .claude/call-graph.json
    fi
fi
