{
  "tasks": [
    {
      "id": "task-feedback-metrics-reader",
      "objective": "[feedback] Create metrics reader - load metrics.jsonl, parse outcomes, compute success rates by model/complexity",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:00:00.000Z",
      "tags": [
        "feedback-loop",
        "metrics"
      ]
    },
    {
      "id": "task-feedback-routing-adjustment",
      "objective": "[feedback] Wire metrics to routing - adjust complexity thresholds based on historical success rates per model tier",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:00:00.000Z",
      "tags": [
        "feedback-loop",
        "routing"
      ],
      "dependsOn": [
        "task-feedback-metrics-reader"
      ]
    },
    {
      "id": "task-feedback-introspect-command",
      "objective": "[feedback] Add 'undercity introspect' command - analyze own metrics, identify improvement opportunities, generate tasks",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:00:00.000Z",
      "tags": [
        "feedback-loop",
        "self-improvement"
      ],
      "dependsOn": [
        "task-feedback-metrics-reader"
      ]
    },
    {
      "id": "task-feedback-ab-integration",
      "objective": "[feedback] Wire experiment framework to grind - randomly assign tasks to variants, track which routing/prompts work better",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:00:00.000Z",
      "tags": [
        "feedback-loop",
        "experiments"
      ]
    },
    {
      "id": "task-feedback-pattern-learning",
      "objective": "[feedback] Learn task patterns - cluster similar tasks by objective keywords, track which patterns succeed at which tiers",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:00:00.000Z",
      "tags": [
        "feedback-loop",
        "learning"
      ],
      "dependsOn": [
        "task-feedback-metrics-reader"
      ]
    },
    {
      "id": "task-context-ast-indexer",
      "objective": "[context] Build AST indexer - parse TypeScript files, extract function/class/type definitions, store in queryable format for fast lookup",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:10:00.000Z",
      "tags": [
        "context",
        "tooling"
      ]
    },
    {
      "id": "task-context-dependency-graph",
      "objective": "[context] Build dependency graph - map imports/exports between files, identify which files are affected by changes to a given file",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:10:00.000Z",
      "tags": [
        "context",
        "tooling"
      ]
    },
    {
      "id": "task-context-file-summaries",
      "objective": "[context] Pre-compute file summaries - for each file, generate a 1-2 line description of purpose/exports, cache for fast context loading",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:10:00.000Z",
      "tags": [
        "context",
        "tooling"
      ]
    },
    {
      "id": "task-context-smart-context",
      "objective": "[context] Smart context selection - given a task, automatically identify which files/functions are relevant using AST + dependency graph",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:10:00.000Z",
      "tags": [
        "context",
        "tooling"
      ],
      "dependsOn": [
        "task-context-ast-indexer",
        "task-context-dependency-graph"
      ]
    },
    {
      "id": "task-metrics-success-rate",
      "objective": "[metrics] Track success rate per complexity level - which tasks need escalation most?",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-10T08:50:00.000Z",
      "tags": [
        "metrics"
      ]
    },
    {
      "id": "task-grind-improvements",
      "objective": "[grind] Improve grind command - better task selection, skip already-complete, priority ordering",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-10T08:50:00.000Z",
      "tags": [
        "grind"
      ]
    },
    {
      "id": "task-conflict-detection",
      "objective": "[integration] Conflict detection - if two workers touch same files, flag before merge attempt",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-10T09:53:15.928Z",
      "tags": [
        "parallel"
      ]
    },
    {
      "id": "task-verify-retry-logic",
      "objective": "[grind] Improve verification retry logic - allow multiple fix attempts at same tier before escalating",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-10T10:47:55.888Z",
      "tags": [
        "grind",
        "verification"
      ]
    },
    {
      "id": "task-dspy-evaluation",
      "objective": "[learning] Evaluate DSPy for prompt optimization - assess if prompt quality is the bottleneck vs routing/model selection",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-10T09:51:35.101Z",
      "tags": [
        "learning",
        "prompts"
      ]
    },
    {
      "id": "task-continuous-sync",
      "objective": "[continuous] Sync task board with grind - mark tasks complete when merged, update status during execution",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T02:15:00.000Z",
      "tags": [
        "continuous"
      ]
    },
    {
      "id": "task-spell-nonblocking",
      "objective": "[verify] Make spell check non-blocking - spell failures should warn but not fail verification",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T02:15:00.000Z",
      "tags": [
        "verification"
      ]
    },
    {
      "id": "task-onboard-init",
      "objective": "[onboard] Create 'undercity init' command - interactive/auto-detecting setup for new projects, creates .undercity/ structure",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:30:00.000Z",
      "tags": [
        "onboarding",
        "portability"
      ]
    },
    {
      "id": "task-onboard-detect-tooling",
      "objective": "[onboard] Auto-detect project tooling - scan package.json/configs for package manager, test runner, linter, build system",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:30:00.000Z",
      "tags": [
        "onboarding",
        "portability"
      ]
    },
    {
      "id": "task-onboard-verify-abstraction",
      "objective": "[onboard] Abstract verification loop - replace hardcoded 'pnpm check && pnpm build && pnpm test' with configurable project-specific commands",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:30:00.000Z",
      "tags": [
        "onboarding",
        "portability"
      ],
      "dependsOn": [
        "task-onboard-detect-tooling"
      ]
    },
    {
      "id": "task-onboard-scout-rules",
      "objective": "[onboard] Scout-generated rules - use scout agent to analyze codebase and generate .claude/rules/ with architecture, patterns, conventions",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:30:00.000Z",
      "tags": [
        "onboarding",
        "portability"
      ]
    },
    {
      "id": "task-onboard-project-profile",
      "objective": "[onboard] Create project profile system - .undercity/profile.json storing learned patterns, failure modes, optimal thresholds per project",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:30:00.000Z",
      "tags": [
        "onboarding",
        "learning"
      ]
    },
    {
      "id": "task-onboard-self-tune",
      "objective": "[onboard] Self-tuning after tasks - analyze verification failures, adjust complexity routing, update project profile automatically",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:30:00.000Z",
      "tags": [
        "onboarding",
        "learning"
      ],
      "dependsOn": [
        "task-onboard-project-profile",
        "task-feedback-metrics-reader"
      ]
    },
    {
      "id": "task-portable-package",
      "objective": "[portable] Make undercity installable as npm package - 'npx undercity init' or 'pnpm add -D undercity' workflow",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:30:00.000Z",
      "tags": [
        "portability",
        "distribution"
      ]
    },
    {
      "id": "task-agent-optimize-oracle",
      "objective": "[agent-opt] Rewrite oracle cards for agent utility - replace poetic lore with concrete examples, action patterns, or decision heuristics that actually help agents",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:35:00.000Z",
      "tags": [
        "agent-optimization",
        "prompts"
      ]
    },
    {
      "id": "task-agent-optimize-prompts",
      "objective": "[agent-opt] Audit all agent prompts (squad definitions) - optimize for task completion, remove fluff, add concrete behavioral guidelines",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T07:35:00.000Z",
      "tags": [
        "agent-optimization",
        "prompts"
      ]
    },
    {
      "id": "task-mka7ceac-m3kf",
      "objective": "[periodic] Run semantic-check and fix high-priority density issues",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T20:44:14.292Z"
    },
    {
      "id": "task-mka7cfkg-avsy",
      "objective": "[optimization] Review .claude/rules files for semantic density improvements",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T20:44:15.952Z"
    },
    {
      "id": "task-mka7chrr-udp0",
      "objective": "[optimization] Convert low-density prose to tables/lists in documentation",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T20:44:18.807Z"
    },
    {
      "id": "task-mkab2aof-ygpz",
      "objective": "[grind] Enhanced verification retry logic - opus tier should get 7 attempts instead of 2, progressive escalation with more retries per tier",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T22:28:21.519Z"
    },
    {
      "id": "task-mkab2b12-h2rm",
      "objective": "[grind] Task conflict detection - before starting task, check if similar task (>70% similarity) is already running",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T22:28:21.974Z"
    },
    {
      "id": "task-mkab2bct-bb5k",
      "objective": "[grind] Improve agent prompts - add instruction to check git log before implementing, return TASK_ALREADY_COMPLETE if work exists",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T22:28:22.397Z"
    },
    {
      "id": "task-mkab2bog-89d5",
      "objective": "[docs] Add reconciliation to grind workflow docs - explain when to run reconcile, how confidence scoring works",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T22:28:22.816Z"
    },
    {
      "id": "task-mkab3cik-8i42",
      "objective": "[cli] Add --priority flag to 'undercity add' command for explicit task prioritization",
      "status": "pending",
      "priority": 3,
      "createdAt": "2026-01-11T22:29:10.556Z"
    },
    {
      "id": "task-mkabr2sc-ffur",
      "objective": "[refactor] Refactor git.ts Elevator.processNext method - complexity 18, 2 nested blocks. Simplify merge processing logic",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T22:47:37.692Z"
    },
    {
      "id": "task-mkabr37z-vjy8",
      "objective": "[refactor] Refactor git.ts Elevator.processWorktreeBranch method - complexity 17. Extract rebase and merge strategies",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T22:47:38.255Z"
    },
    {
      "id": "task-mkabr42j-4igg",
      "objective": "[refactor] Reduce primitive obsession in task.ts - 89% primitive args. Introduce typed parameter objects where appropriate",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T22:47:39.355Z"
    },
    {
      "id": "task-mkadtxcu-cn6i",
      "objective": "[cli] Add 'undercity update' command - update task objective, priority, tags, or status. Usage: undercity update <task-id> --objective '...' --priority N --tags tag1,tag2",
      "status": "pending",
      "priority": 900,
      "createdAt": "2026-01-11T23:45:49.854Z"
    },
    {
      "id": "task-mf48mfkx7msu",
      "objective": "[stabilization] Add real-time grind reporting - show what's happening now, don't wait for completion",
      "status": "complete",
      "priority": 4,
      "createdAt": "2026-01-12T01:12:23.614Z",
      "tags": [
        "stabilization"
      ],
      "completedAt": "2026-01-12T04:42:34.000Z"
    },
    {
      "id": "task-8znf83r59zvq",
      "objective": "[stabilization] Add error boundaries to grind - one task failure shouldn't crash entire grind",
      "status": "complete",
      "priority": 5,
      "createdAt": "2026-01-12T01:12:23.614Z",
      "tags": [
        "stabilization"
      ],
      "completedAt": "2026-01-12T04:47:00.000Z"
    },
    {
      "id": "task-k68i4doys6bq",
      "objective": "[stabilization] Test grind on 10 real tasks, measure success rate, document failures",
      "status": "pending",
      "priority": 6,
      "createdAt": "2026-01-12T01:12:23.614Z",
      "tags": [
        "stabilization"
      ]
    },
    {
      "id": "task-c1h63skgeqjo",
      "objective": "[stabilization] Make verification retries configurable - currently hardcoded and confusing",
      "status": "complete",
      "priority": 8,
      "createdAt": "2026-01-12T01:12:23.614Z",
      "tags": [
        "stabilization"
      ],
      "completedAt": "2026-01-12T05:35:00.000Z"
    },
    {
      "id": "task-priming-work-hook",
      "objective": "[priming] Implement work hook system - write assignment.json to worktree before spawning agent. Assignment survives crashes. Agent reads assignment on startup and enters autonomous mode immediately",
      "status": "pending",
      "priority": 10,
      "createdAt": "2026-01-12T04:00:00.000Z",
      "tags": [
        "priming",
        "gastown-pattern",
        "critical"
      ]
    },
    {
      "id": "task-priming-per-task-checkpoint",
      "objective": "[priming] Implement per-task checkpoints - write .undercity/checkpoints/{taskId}.json after each significant action. Track: lastAction, modifiedFiles, verificationStatus, attempt number. Enables granular crash recovery",
      "status": "pending",
      "priority": 11,
      "createdAt": "2026-01-12T04:00:00.000Z",
      "tags": [
        "priming",
        "gastown-pattern",
        "recovery"
      ]
    },
    {
      "id": "task-priming-worker-prompt",
      "objective": "[priming] Create worker prompt template with propulsion directive - include task assignment, verification requirements, completion protocol, and explicit DO NOT list (no questions, no waiting, no planning before acting)",
      "status": "pending",
      "priority": 12,
      "createdAt": "2026-01-12T04:00:00.000Z",
      "tags": [
        "priming",
        "gastown-pattern",
        "prompts"
      ],
      "dependsOn": [
        "task-priming-work-hook"
      ]
    },
    {
      "id": "task-priming-checkpoint-recovery",
      "objective": "[priming] Wire checkpoint recovery to worker spawn - on crash recovery, inject checkpoint context into worker prompt showing previous progress, modified files, and resume point",
      "status": "pending",
      "priority": 13,
      "createdAt": "2026-01-12T04:00:00.000Z",
      "tags": [
        "priming",
        "gastown-pattern",
        "recovery"
      ],
      "dependsOn": [
        "task-priming-per-task-checkpoint",
        "task-priming-worker-prompt"
      ]
    },
    {
      "id": "task-priming-identity-from-path",
      "objective": "[priming] Add worker identity detection from worktree path - worker knows its task ID, branch, and role from directory structure. No need to pass context explicitly",
      "status": "pending",
      "priority": 14,
      "createdAt": "2026-01-12T04:00:00.000Z",
      "tags": [
        "priming",
        "gastown-pattern"
      ]
    },
    {
      "id": "task-priming-verification-status-tracking",
      "objective": "[priming] Track verification status per checkpoint - record which verifications (typecheck/test/lint) passed/failed per attempt. Worker sees what already passed and focuses on failures",
      "status": "pending",
      "priority": 15,
      "createdAt": "2026-01-12T04:00:00.000Z",
      "tags": [
        "priming",
        "gastown-pattern",
        "verification"
      ],
      "dependsOn": [
        "task-priming-per-task-checkpoint"
      ]
    },
    {
      "id": "task-skill-claude-code-integration",
      "objective": "[skill] Create undercity as Claude Code skill - expose grind, add, tasks commands as skill invocations. Normal Claude Code session can spawn undercity for autonomous batch work",
      "status": "pending",
      "priority": 20,
      "createdAt": "2026-01-12T04:00:00.000Z",
      "tags": [
        "skill",
        "claude-code",
        "integration"
      ]
    },
    {
      "id": "task-skill-handoff-protocol",
      "objective": "[skill] Implement handoff protocol - when Claude Code invokes undercity skill, pass current context (files read, decisions made) as handoff content. Undercity workers start with context, not cold",
      "status": "pending",
      "priority": 21,
      "createdAt": "2026-01-12T04:00:00.000Z",
      "tags": [
        "skill",
        "claude-code",
        "context"
      ],
      "dependsOn": [
        "task-skill-claude-code-integration"
      ]
    },
    {
      "id": "task-skill-results-return",
      "objective": "[skill] Implement results return protocol - when undercity completes tasks, return structured summary to calling Claude Code session. Include: tasks completed, files changed, any failures",
      "status": "pending",
      "priority": 22,
      "createdAt": "2026-01-12T04:00:00.000Z",
      "tags": [
        "skill",
        "claude-code",
        "integration"
      ],
      "dependsOn": [
        "task-skill-claude-code-integration"
      ]
    },
    {
      "id": "task-witness-health-monitor",
      "objective": "[witness] Add lightweight health monitoring - detect stuck workers (no checkpoint update in N minutes), log warnings before killing. Pattern from gastown witness",
      "status": "pending",
      "priority": 25,
      "createdAt": "2026-01-12T04:00:00.000Z",
      "tags": [
        "witness",
        "gastown-pattern",
        "monitoring"
      ],
      "dependsOn": [
        "task-priming-per-task-checkpoint"
      ]
    },
    {
      "id": "task-witness-nudge-before-kill",
      "objective": "[witness] Implement nudge-before-kill pattern - if worker appears stuck, send context nudge before terminating. Give worker chance to recover",
      "status": "pending",
      "priority": 26,
      "createdAt": "2026-01-12T04:00:00.000Z",
      "tags": [
        "witness",
        "gastown-pattern",
        "monitoring"
      ],
      "dependsOn": [
        "task-witness-health-monitor"
      ]
    },
    {
      "id": "task-push-after-success",
      "objective": "[integration] Add push-after-success option - optionally push to remote after successful merge. Default off, enable with --push flag or config",
      "status": "pending",
      "priority": 30,
      "createdAt": "2026-01-12T04:00:00.000Z",
      "tags": [
        "integration",
        "git"
      ]
    },
    {
      "id": "task-atomic-recovery-state",
      "objective": "[recovery] Implement atomic recovery state - replace fragile recovery.json with directory structure: .undercity/active/{taskId}.state and .undercity/completed/{taskId}.done. On crash, scan active/ to resume. Atomic file ops prevent corruption",
      "status": "pending",
      "priority": 9,
      "createdAt": "2026-01-12T04:10:00.000Z",
      "tags": [
        "recovery",
        "gastown-pattern",
        "critical"
      ]
    },
    {
      "id": "task-phase3-metrics-dashboard",
      "objective": "[phase3] Build metrics dashboard - display token usage per model, success/failure rates by complexity, cost tracking over time. Integrate with existing live-metrics.ts",
      "status": "pending",
      "priority": 100,
      "createdAt": "2026-01-12T04:10:00.000Z",
      "tags": [
        "phase3",
        "metrics",
        "polish"
      ]
    },
    {
      "id": "task-phase3-capability-ledger",
      "objective": "[phase3] Create capability ledger - track what task types succeed at each model tier. Use historical data to improve routing decisions. Store in .undercity/capability-ledger.json",
      "status": "pending",
      "priority": 101,
      "createdAt": "2026-01-12T04:10:00.000Z",
      "tags": [
        "phase3",
        "learning",
        "polish"
      ],
      "dependsOn": [
        "task-feedback-metrics-reader"
      ]
    }
  ],
  "lastUpdated": "2026-01-12T04:42:34.000Z"
}
